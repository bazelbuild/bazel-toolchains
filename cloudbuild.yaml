# Launch a RBE hello world build + unit test using the @rbe_default toolchain
# configs.
steps:
- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with Bazel 0.24.1 and uses checked-in configs directly
# w/o using rbe_autoconfig
- name: 'marketplace.gcr.io/google/bazel:0.24.1'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=//configs/ubuntu16_04_clang/9.0.0/bazel_0.24.1/java:jdk
  - --javabase=//configs/ubuntu16_04_clang/9.0.0/bazel_0.24.1/java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=//configs/ubuntu16_04_clang/9.0.0/bazel_0.24.1/cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=//configs/ubuntu16_04_clang/9.0.0/bazel_0.24.1/config:cc-toolchain
  - --extra_execution_platforms=//configs/ubuntu16_04_clang/9.0.0/bazel_0.24.1/config:platform
  - --host_platform=//configs/ubuntu16_04_clang/9.0.0/bazel_0.24.1/config:platform
  - --platforms=//configs/ubuntu16_04_clang/9.0.0/bazel_0.24.1/config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with rbe_autoconfig with bazel0.24.1
- name: 'marketplace.gcr.io/google/bazel:0.24.1'
  args:
  - --bazelrc=bazelrc/.bazelrc
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with rbe_autoconfig with bazel0.24.0
- name: 'marketplace.gcr.io/google/bazel:0.24.0'
  args:
  - --bazelrc=bazelrc/.bazelrc
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with rbe_autoconfig with bazel0.23.2
- name: 'marketplace.gcr.io/google/bazel:0.23.2'
  args:
  - --bazelrc=bazelrc/.bazelrc
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with rbe_autoconfig with bazel0.23.1
- name: 'marketplace.gcr.io/google/bazel:0.23.1'
  args:
  - --bazelrc=bazelrc/.bazelrc
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with rbe_autoconfig with bazel0.23.0
- name: 'marketplace.gcr.io/google/bazel:0.23.0'
  args:
  - --bazelrc=bazelrc/.bazelrc
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with rbe_autoconfig with bazel0.22.0
- name: 'marketplace.gcr.io/google/bazel:0.22.0'
  args:
  - --bazelrc=bazelrc/.bazelrc
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

# Test that runs with rbe_autoconfig_autogen_ubuntu1604 with latest bazel
- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconfig_autogen_ubuntu1604//java:jdk
  - --javabase=@rbe_autoconfig_autogen_ubuntu1604//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconfig_autogen_ubuntu1604//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconfig_autogen_ubuntu1604//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconfig_autogen_ubuntu1604//config:platform
  - --host_platform=@rbe_autoconfig_autogen_ubuntu1604//config:platform
  - --platforms=@rbe_autoconfig_autogen_ubuntu1604//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_checked_in//java:jdk
  - --javabase=@rbe_autoconf_checked_in//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_checked_in//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_checked_in//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_checked_in//config:platform
  - --host_platform=@rbe_autoconf_checked_in//config:platform
  - --platforms=@rbe_autoconf_checked_in//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_checked_in_no_java//java:jdk
  - --javabase=@rbe_autoconf_checked_in_no_java//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_checked_in_no_java//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_checked_in_no_java//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_checked_in_no_java//config:platform
  - --host_platform=@rbe_autoconf_checked_in_no_java//config:platform
  - --platforms=@rbe_autoconf_checked_in_no_java//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_generate//java:jdk
  - --javabase=@rbe_autoconf_generate//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_generate//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_generate//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_generate//config:platform
  - --host_platform=@rbe_autoconf_generate//config:platform
  - --platforms=@rbe_autoconf_generate//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_generate_no_java//java:jdk
  - --javabase=@rbe_autoconf_generate_no_java//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_generate_no_java//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_generate_no_java//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_generate_no_java//config:platform
  - --host_platform=@rbe_autoconf_generate_no_java//config:platform
  - --platforms=@rbe_autoconf_generate_no_java//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_config_repos//java:jdk
  - --javabase=@rbe_autoconf_config_repos//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_config_repos//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_config_repos//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_config_repos//config:platform
  - --host_platform=@rbe_autoconf_config_repos//config:platform
  - --platforms=@rbe_autoconf_config_repos//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_custom_java_home//java:jdk
  - --javabase=@rbe_autoconf_custom_java_home//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_custom_java_home//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_custom_java_home//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_custom_java_home//config:platform
  - --host_platform=@rbe_autoconf_custom_java_home//config:platform
  - --platforms=@rbe_autoconf_custom_java_home//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_old_container//java:jdk
  - --javabase=@rbe_autoconf_old_container//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_old_container//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_old_container//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_old_container//config:platform
  - --host_platform=@rbe_autoconf_old_container//config:platform
  - --platforms=@rbe_autoconf_old_container//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_base_container_digest//java:jdk
  - --javabase=@rbe_autoconf_base_container_digest//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_base_container_digest//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_base_container_digest//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_base_container_digest//config:platform
  - --host_platform=@rbe_autoconf_base_container_digest//config:platform
  - --platforms=@rbe_autoconf_base_container_digest//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_constraints//java:jdk
  - --javabase=@rbe_autoconf_constraints//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_constraints//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_constraints//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_constraints//config:platform
  - --host_platform=@rbe_autoconf_constraints//config:platform
  - --platforms=@rbe_autoconf_constraints//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_resovle_tag//java:jdk
  - --javabase=@rbe_autoconf_resovle_tag//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_resovle_tag//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_resovle_tag//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_resovle_tag//config:platform
  - --host_platform=@rbe_autoconf_resovle_tag//config:platform
  - --platforms=@rbe_autoconf_resovle_tag//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_output_base//java:jdk
  - --javabase=@rbe_autoconf_output_base//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_output_base//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_output_base//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_output_base//config:platform
  - --host_platform=@rbe_autoconf_output_base//config:platform
  - --platforms=@rbe_autoconf_output_base//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_output_base_no_java//java:jdk
  - --javabase=@rbe_autoconf_output_base_no_java//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_output_base_no_java//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_output_base_no_java//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_output_base_no_java//config:platform
  - --host_platform=@rbe_autoconf_output_base_no_java//config:platform
  - --platforms=@rbe_autoconf_output_base_no_java//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_config_repos_output_base//java:jdk
  - --javabase=@rbe_autoconf_config_repos_output_base//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_config_repos_output_base//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_config_repos_output_base//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_config_repos_output_base//config:platform
  - --host_platform=@rbe_autoconf_config_repos_output_base//config:platform
  - --platforms=@rbe_autoconf_config_repos_output_base//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_generate_no_docker_pull//java:jdk
  - --javabase=@rbe_autoconf_generate_no_docker_pull//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_generate_no_docker_pull//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_generate_no_docker_pull//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_generate_no_docker_pull//config:platform
  - --host_platform=@rbe_autoconf_generate_no_docker_pull//config:platform
  - --platforms=@rbe_autoconf_generate_no_docker_pull//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached

- name: 'marketplace.gcr.io/google/bazel'
  args:
  - --bazelrc=bazelrc/.bazelrc.test
  - test
  - //examples/remotebuildexecution/hello_world/cc:say_hello_test
  - --config=remote
  - --host_javabase=@rbe_autoconf_custom_container//java:jdk
  - --javabase=@rbe_autoconf_custom_container//java:jdk
  - --host_java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --java_toolchain=@bazel_tools//tools/jdk:toolchain_hostjdk8
  - --crosstool_top=@rbe_autoconf_custom_container//cc:toolchain
  - --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
  - --extra_toolchains=@rbe_autoconf_custom_container//config:cc-toolchain
  - --extra_execution_platforms=@rbe_autoconf_custom_container//config:platform
  - --host_platform=@rbe_autoconf_custom_container//config:platform
  - --platforms=@rbe_autoconf_custom_container//config:platform
  - --remote_instance_name=projects/asci-toolchain/instances/default_instance
  - --noremote_accept_cached
